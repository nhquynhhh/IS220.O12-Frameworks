@model Ecommerce.Models.Product

@section Styles{
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.min.css" rel="stylesheet">
}

@{
    ViewData["Title"] = Model.ProductName;
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Product> SuggestedProducts = ViewBag.SanPham;
}

<div class="product-view grid-product-view">
    <div class="product-img-container grid-image">
        <div class="large-image">
            <img src="@Model.ProductImage" alt="" width="450" height="450">
        </div>
    </div>
    <div class="product-info-container">
        <div class="product-brand">
            <h3>@Model.ProductBrand.BrandName</h3>
        </div>
        <div class="product-name" style="margin-top: 30px;">
            <h1>@Model.ProductName</h1>
        </div>
        <div class="product-price">
            <strong class="left discounted-price">@Model.ProductDiscountPrice.Value.ToString("#,##0") đ</strong>
            <span class="right real-price">@Model.ProductOriginalPrice.Value.ToString("#,##0") đ</span>
        </div>
        <br><br>
        <div class="product-variant">
            <div class="product-amount">
                <h5>Số lượng: </h5>
                <button class="btn btn-link px-2 "
                        onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                    <i class="fas fa-minus"></i>
                </button>
                <input type="number" min="1" value="1" id="productQuantity" name="productQuantity">
                <button class="btn btn-link px-2"
                        onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="btn-product">
                <button class="btn-add-to-cart"><i class="fa-solid fa-cart-shopping"></i> Thêm vào giỏ hàng</button>
                <button class="btn-buy-now">Mua ngay</button>
                <input hidden asp-for="ProductId" />
            </div>
        </div>
    </div>
</div>

<div class="product-detail-information product-box">
    <div class="product-detail-information-title width-common">
        <h2 class="section-txt-title">Thông tin sản phẩm</h2>
    </div>
    <div class="product-detail-information-content">
        @Html.Raw(Model.ProductInfo)
    </div>
</div>

<div class="product-detail-parameter product-box">
    <div class="product-detail-parameter-title">
        <h2 class="section-txt-title">Thông số sản phẩm</h2>
    </div>
    <table class="parameter-detail">
        <tr>
            <th>Mã sản phẩm</th>
            <td>@Model.ProductId</td>
        </tr>
        <tr>
            <th>Barcode</th>
            <td>@Model.ProductBarcode</td>
        </tr>
        <tr>
            <th>Thương hiệu</th>
            <td>@Model.ProductBrand.BrandName</td>
        </tr>
        <tr>
            <th>Xuất xứ</th>
            <td>@Model.ProductBrand.BrandOrigin</td>
        </tr>
        <tr>
            <th>Danh mục sản phẩm</th>
            <td>@Model.ProductSubCategory.SubCategoryName / @Model.ProductCategory.CategoryName</td>
        </tr>
    </table>
</div>

<div class="product-review-customer product-box">
    <div class="product-review-customer-title">
        <h2 class="section-txt-title">Đánh giá</h2>
    </div>
    <div class="product-review-customer-detail">
        <div class="review-product-average">
            <span>Đánh giá trung bình </span>
            <i class="fa-solid fa-star checked"></i>
            <i class="fa-solid fa-star checked"></i>
            <i class="fa-solid fa-star checked"></i>
            <i class="fa-solid fa-star checked"></i>
            <i class="fa-solid fa-star"></i>
            <hr>
            <div class="row">
                <div class="side-star">
                    <div>5 sao</div>
                </div>
                <div class="middle">
                    <div class="bar-container">
                        <div class="bar-5"></div>
                    </div>
                </div>
                <div class="side-star txt-right">
                    <div>150</div>
                </div>
                <div class="side-star">
                    <div>4 sao</div>
                </div>
                <div class="middle">
                    <div class="bar-container">
                        <div class="bar-4"></div>
                    </div>
                </div>
                <div class="side-star txt-right">
                    <div>63</div>
                </div>
                <div class="side-star">
                    <div>3 sao</div>
                </div>
                <div class="middle">
                    <div class="bar-container">
                        <div class="bar-3"></div>
                    </div>
                </div>
                <div class="side-star txt-right">
                    <div>15</div>
                </div>
                <div class="side-star">
                    <div>2 sao</div>
                </div>
                <div class="middle">
                    <div class="bar-container">
                        <div class="bar-2"></div>
                    </div>
                </div>
                <div class="side-star txt-right">
                    <div>6</div>
                </div>
                <div class="side-star">
                    <div>1 sao</div>
                </div>
                <div class="middle">
                    <div class="bar-container">
                        <div class="bar-1"></div>
                    </div>
                </div>
                <div class="side-star txt-right">
                    <div>20</div>
                </div>
            </div>
        </div>
        <br>
        <span>Đánh giá nổi bật</span>
        <div class="review-detail">
            <div class="rating-star">
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star"></i>
            </div>
            <div class="name-rating-customer">Nguyễn Nguyễn Nguyễn</div>
            <div class="review-content">
                Sản phẩm kiềm dầu tốt, che phủ chắc chắn, không bị nâng tông quá nhiều.
            </div>
            <div class="review-date txt-12">
                17/04/2023
            </div>
        </div>
        <div class="review-detail">
            <div class="rating-star">
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star"></i>
            </div>
            <div class="name-rating-customer">Nguyễn Nguyễn Nguyễn</div>
            <div class="review-content">
                Sản phẩm kiềm dầu tốt, che phủ chắc chắn, không bị nâng tông quá nhiều.
            </div>
            <div class="review-date txt-12">
                17/04/2023
            </div>
        </div>
        <div class="review-detail">
            <div class="rating-star">
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star checked"></i>
                <i class="fa-solid fa-star"></i>
            </div>
            <div class="name-rating-customer">Nguyễn Nguyễn Nguyễn</div>
            <div class="review-content">
                Sản phẩm kiềm dầu tốt, che phủ chắc chắn, không bị nâng tông quá nhiều.
            </div>
            <div class="review-date txt-12">
                17/04/2023
            </div>
        </div>
    </div>
</div>

<div class="relative-products-4 product-box">
    <div class="relative-products-4-title">
        <h2 class="section-txt-title">Sản phẩm tương tự</h2>
    </div>
    <div class="suggested-product-content grid-4-col">
        @if (SuggestedProducts != null && SuggestedProducts.Count() > 0)
        {
            foreach (var item in SuggestedProducts)
            {
                string url = $"/Product/{item.ProductSlug}-{item.ProductId}.html";
                <div class="preview-product">
                    <div class="product-ping width-common relative">
                        <a href="@url" class="image-common relative">
                            <div class="product-img sale">
                                <img src="@item.ProductImage" alt="" height="220" width="220">
                                <span class="sale-percent">@Math.Round((decimal)(Math.Round(Decimal.Divide((decimal)item.ProductDiscountPrice, (decimal)item.ProductOriginalPrice), 1) * 100))%</span>
                            </div>
                            <div class="product-info">
                                <div class="width-common price-block">
                                    <strong class="discount-price txt-16">@item.ProductDiscountPrice.Value.ToString("#,##0") &#8363;</strong>
                                    <span class="original-price txt-12 right">@item.ProductOriginalPrice.Value.ToString("#,##0") &#8363;</span>
                                </div>
                                <div class="product-name-block">
                                    <h3 class="width-common pr-name sp-bottom-5">
                                        <div class="product-name cyan-link">@item.ProductName</div>
                                    </h3>
                                </div>
                                <div class="rate-block">
                                    <span class="rate-star left"><i class="fa-solid fa-star"></i></span>
                                    <span class="sold-product-number right">Đã bán: 100+</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            }
        }
    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            $(function () {
                $(".btn-add-to-cart").click(function () {
                    var productid = $('#ProductId').val();
                    var soLuong = $('#productQuantity').val();
                    $.ajax({ 
                        url: '/api/cart/add',
                        type: "POST",
                        dataType: "JSON",
                        data: {
                            productID: productid,
                            amount: soLuong
                        },
                        success: function (response) {
                            if (response.result == 'Redirect') {
                                window.location = response.url;
                            }
                            else {
                                let timerInterval;
                                Swal.fire({
                                    title: "Thêm vào giỏ hàng thành công!",
                                    html: "Cửa sổ này sẽ tự động đóng sau 3 giây.",
                                    timer: 3000,
                                    icon: "success",
                                    timerProgressBar: true,
                                    didOpen: () => {
                                        Swal.showLoading();
                                        const timer = Swal.getPopup().querySelector("b");
                                        timerInterval = setInterval(() => {
                                            timer.textContent = `${Swal.getTimerLeft()}`;
                                        }, 100);
                                    },
                                    willClose: () => {
                                        clearInterval(timerInterval);
                                    }
                                }).then((result) => {
                                    /* Read more about handling dismissals below */
                                    if (result.dismiss === Swal.DismissReason.timer) {
                                        console.log("I was closed by the timer");
                                    }
                                });
                            }
                        },
                        error: function (error) {
                            alert("Lỗi thêm sản phẩm. ");
                        }
                    });
                });
            });
        });
    </script>
    <script src="/user_assets/js/vendor/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.2/dist/sweetalert2.all.min.js"></script>
}